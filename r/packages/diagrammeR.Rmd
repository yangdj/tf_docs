```{r setup, include = FALSE}
    library(DiagrammeR)
    library(DiagrammeRsvg)
    library(dplyr)
    library(svgPanZoom)
```

# DiagrammeR

## Graphviz

A Graphviz graph must begin with a directed graph `digraph` or an undirected `graph`. The syntax is:

```
[strict] (graph | digraph) [ID] '{' stmt_list '}'
``` 
`Strict` forbids the creation of multi-edges.

Comments may be placed within the statement list. These can be marked using a `//` or a `/* */` structure. Comment lines are denoted by a `#` character. Multiple statements within a statement list can be separated by linebreaks or `;` characters between multiple statements.

### Graph attributes

Graph statements allow for attributes to be set for all components of the graph.

* layout:
    * dot
    * neato
    * twopi
    * circo
* rankdir:
    * LR
    * TB
* overlap:
    * true
    * false
* nodesep
* ranksep
* compound
  * lhead
  * ltail
* rank
  * same
  * min
  * source
  * max
  * sink

#### Node attributes:

Node statements define and provide attributes for graph nodes. Quotation marks are important only for multiword attributes, such might be used in the label attribute.

```{r}
svgPanZoom(export_svg(
grViz("
      digraph node_attributes {

        graph [rankdir = LR]
        
        # set node with default attributes
        node [color=red shape=box]

        root [label = 'node']

        # node attributes
        shape
        peripheries
        sides
        distortion
        penwidth
        color
        style
        fillcolor
        fontname
        fontsize
        fontcolor
        tooltip
        width
        height
        icon
        fixedsize[label='fixedsize: true|false']
        x[label='x: requires graph layout=neato']
        y[label='y: requires graph layout=neato']
      
        # shape
        shape_oval[shape=oval, label='oval(default)']
        shape_box[shape=box, label='box']
        shape_square[shape=square, label='square']
        shape_circle[shape=circle, label='circle']
        shape_egg[shape=egg, label='egg']
        shape_triangle[shape=triangle, label='triangle']
        shape_diamond[shape=diamond, label='diamond']
        shape_polygon[shape=polygon, label='polygon']
        shape_msquare[shape=Msquare, label='Msquare']
        shape_mdiamond[shape=Mdiamond, label='Mdiamond']
        shape_point[shape=point, label='point']
        shape_plaintext[shape=plaintext, label='plaintext']

        # peripheries
        peripheries_2[peripheries=2, label='2']
        peripheries_4[peripheries=4, label='4']

        # sides
        shape_polygon_s5[shape=polygon, label='5', sides=5]
        shape_polygon_s6[shape=polygon, label='6', sides=6]

        # distortion
        shape_polygon_distortion_1[shape=polygon, sides=5, label='1', distortion=1]
        shape_polygon_distortion_2[shape=polygon, sides=5, label='2', distortion=2]

        # penwidth
        penwidth_1[penwidth=1, label='1']
        penwidth_10[penwidth=10, label='10']

        # color
        color_yellow[color=yellow, label='yellow']
        color_hex[color='#00FF00', label='\\'#00FF00\\'']
        
        # style
        style_solid[style=solid, label='solid(default)']
        style_bold[style=bold, label='bold']
        style_filled[style=filled, label='filled']
        style_rounded[style=rounded, label='rounded']
        style_dotted[style=dotted, label='dotted']
        style_dashed[style=dashed, label='dashed']
        style_diagonals[style=diagonals, label='diagonals']
        style_striped[style=striped, label='striped']
        style_wedged[style=wedged, label='wedged']

        # fillcolor
        fillcolor_yellow[style=filled, fillcolor=yellow, label='yellow']
        fillcolor_green[style=filled, fillcolor='#00FF00', label='\\'#00FF00\\'']
        fillcolor_greena[style=filled, fillcolor='#00FF0060', label='\\'#00FF0060 using alpha\\'']

        # fontname
        
        # fontsize
        fontsize_10[fontsize=10, label='10']
        fontsize_15[fontsize=15, label='15']

        # fontcolor
        fontcolor_yellow[fontcolor=yellow, label='yellow']
        fontcolor_green[fontcolor='#00FF00', label='#00FF00']

        # tooltip
        tooltip_hello[tooltip=hello, label='hello']
        tooltip_world[tooltip=world, label='world']

        # width and height
        width_height_1_1[width=1, height=1, label='w=1, h=1']
        width_height_2_1[width=2, height=1, label='w=2, h=1']
        width_height_1_2[width=1, height=2, label='w=1, h=2']
        width_height_2_2[width=2, height=2, label='w=2, h=2']
        
        edge [color=gray]

        root -> {shape, peripheries, penwidth, color, style, fontname, fontsize, fontcolor, tooltip, width, height, icon, fixedsize, x, y}

        shape -> {shape_oval, shape_box, shape_square, shape_circle, shape_egg; shape_triangle, shape_diamond, shape_polygon, shape_msquare, shape_mdiamond, shape_point, shape_plaintext}

        peripheries -> {peripheries_2, peripheries_4}

        shape_polygon -> {sides, distortion}

        sides -> {shape_polygon_s5, shape_polygon_s6}

        distortion -> {shape_polygon_distortion_1, shape_polygon_distortion_2}

        penwidth -> {penwidth_1, penwidth_10}

        color -> {color_yellow, color_hex}

        style -> {style_solid, style_bold, style_filled, style_rounded, style_dotted, style_dashed, style_diagonals, style_striped, style_wedged}

        style_filled -> fillcolor -> {fillcolor_yellow, fillcolor_green, fillcolor_greena}
        
        fontsize -> {fontsize_10, fontsize_15}

        fontcolor -> {fontcolor_yellow, fontcolor_green}

        tooltip -> {tooltip_hello, tooltip_world}

        width -> {width_height_1_1, width_height_2_1}
        height -> {width_height_1_2, width_height_2_2}

      }
      ")
), height="100%")
```

### Edge attributes:

Edge statements specify the edge operations between nodes and they supply attributes to the edges. For the edge operations, a directed graph must specify an edge using the edge operator `->` while an undirected graph must use the `--` operator.

```{r}
svgPanZoom(export_svg(
grViz("
  digraph edge_attributes {
    graph[rankdir=LR]

    node[shape=box, color=red]
    root[label='edge']

    # edge attributed
    dir
    arrowhead[label='arrowhead\narrowtail']
    arrowsize
    penwidth
    minlen
    style
    color
    label
    tooltip
    fontname
    fontsize
    fontcolor
    headport
    tailport

    # dir
    dir_forward[label='forward(default)']
    dir_back[label='back']
    dir_both[label='both']
    dir_none[label='none']

    # arrowhead
    arrowhead_normal[label='normal(default)']
    arrowhead_box[label='box']
    arrowhead_crow[label='crow']
    arrowhead_curve[label='curve']
    arrowhead_diamond[label='diamond']
    arrowhead_dot[label='dot']
    arrowhead_inv[label='inv']
    arrowhead_tee[label='tee']
    arrowhead_vee[label='vee']
    arrowhead_none[label='none']

    # arrowsize
    arrowsize_1[label='1']
    arrowsize_2[label='2']

    # penwidth
    penwidth_1[label='1']
    penwidth_5[label='5']

    # minlen
    minlen_1[label='1']
    minlen_3[label='3']

    # style
    style_solid[label='solid(default)']
    style_dotted[label='dotted']
    style_dashed[label='dashed']
    style_bold[label='bold']

    # color
    color_yellow[label='yellow']
    color_hex[label='\\'#00FF00\\'']

    # label
    label_hello[label='hello']
    label_world[label='world']

    # tooltip
    tooltip_hello[label='hello']
    tooltip_world[label='world']

    # fontsize
    fontsize_10[label='10']
    fontsize_15[label='15']

    # fontcolor
    fontcolor_yellow[label='yellow']
    fontcolor_hex[label='\\'#00FF00\\'']

    # edge
    edge[color=gray]

    root -> {dir, arrowhead, arrowsize, penwidth, minlen, style, color, label, tooltip, fontname, fontsize, fontcolor, headport, tailport}

    dir -> dir_forward[dir=forward]
    dir -> dir_back[dir=back]
    dir -> dir_both[dir=both]
    dir -> dir_none[dir=none]

    arrowhead -> arrowhead_normal[arrowhead=normal]
    arrowhead -> arrowhead_box[arrowhead=box]
    arrowhead -> arrowhead_crow[arrowhead=crow]
    arrowhead -> arrowhead_curve[arrowhead=curve]
    arrowhead -> arrowhead_diamond[arrowhead=diamond]
    arrowhead -> arrowhead_dot[arrowhead=dot]
    arrowhead -> arrowhead_inv[arrowhead=inv]
    arrowhead -> arrowhead_tee[arrowhead=tee]
    arrowhead -> arrowhead_vee[arrowhead=vee]
    arrowhead -> arrowhead_none[arrowhead=none]

    arrowsize -> arrowsize_1[arrowsize=1]
    arrowsize -> arrowsize_2[arrowsize=2]

    penwidth -> penwidth_1[penwidth=1]
    penwidth -> penwidth_5[penwidth=5]

    minlen -> minlen_1[minlen=1]
    minlen -> minlen_3[minlen=3]

    style -> style_solid[style=solid]
    style -> style_dotted[style=dotted]
    style -> style_dashed[style=dashed]
    style -> style_bold[style=bold]

    color -> color_yellow[color=yellow]
    color -> color_hex[color='#00FF00']

    label -> label_hello[label='hello']
    label -> label_world[label='world']

    tooltip -> tooltip_hello[tooltip='hello']
    tooltip -> tooltip_world[tooltip='world']

    fontcolor -> fontcolor_yellow[fontcolor=yellow, label='yellow']
    fontcolor -> fontcolor_hex[fontcolor='#00FF00', label='\\'#00FF00\\'']

    fontsize -> fontsize_10[fontsize=10, label='hello']
    fontsize -> fontsize_15[fontsize=15, label='hello']
  }
")
), height="100%")
```

### Subgraph

```{r}
grViz("
digraph nicegraph {
  
  # graph, node, and edge definitions
  graph [compound = true, nodesep = .5, ranksep = .25,
         color = crimson]

  node [fontname = Helvetica, fontcolor = darkslategray,shape = rectangle, fixedsize = true, width = 1,color = darkslategray]

  edge [color = grey, arrowhead = none, arrowtail = none]

  # subgraph for R information
  subgraph cluster0 {
    node [fixedsize = true, width = 3]
    '@@1-1' -> '@@1-2' -> '@@1-3' -> '@@1-4'
    '@@1-4' -> '@@1-5' -> '@@1-6' -> '@@1-7'
  }

  # subgraph for RStudio information
  subgraph cluster1 {
    node [fixedsize = true, width = 3]
    '@@2' -> '@@3'
  }

  Information             [width = 1.5]
  Information -> R
  Information -> RStudio
  R -> '@@1-1'            [lhead = cluster0]
  RStudio -> '@@2'        [lhead = cluster1]


}

[1]: paste0(names(R.Version())[1:7], ':\\n ', R.Version()[1:7])
[2]: paste0('RStudio version:\\n1.1.463')
[3]: paste0('Current program mode:\\nserver')

")
```

## Mermaid

graph directions:

* TB,TD - top bottom
* BT - bottom top
* RL - right left
* LR - left right

node shapes:

* id[start now] - rectangle
* id(start now) - rectangle with round edges
* id((start now)) - circle
* id>start now] - asymmetric
* id{start now} - rhombus

node links:

* `-->` - arrow head
* `---` - open link
* `a-- this is the text ---b` or `a---|this is the text|b`- text on open links
* `a-- this is the text -->b` or `a-->|this is the text|b`- text on arrow head links
* `a-.->b` - dotted
* `a-. text .->` - dotted with text
* `a ==> b` - thick link
* `a == text ==> b` - thick link with text

subgraphs:

    subgraph title
        graph definition
    end

```{r example}
    DiagrammeR("graph TB
                    id1[start now] -- arrow head --> rectangle
                    id2(start now) -- open link --- round
                    id3((start now)) -. dotted .-> circle
                    id4>start now] == thick link ==> asymmetric
                    id5{start now} --> rhombus
               ")

```

### sequence diagrams

```{r}
mermaid("
     sequenceDiagram
      customer->>ticket seller: ask ticket
      ticket seller->>database: seats
      alt tickets available
        database->>ticket seller: OK
        ticket seller->>customer: confirm
        customer->>ticket seller: OK
        ticket seller->>database: book a seat
        ticket seller->>printer: print a ticket
      else sold out
        database->>ticket seller: none left
        ticket seller->>customer: sorry
      end
")
```


## DiagrammeR API

```{r}
nodes_1 <-
  create_node_df(
    n = 4,
    label = TRUE,
    type = "lower",
    style = "filled",
    color = "aqua",
    shape = c("circle", "circle",
              "rectangle", "rectangle"),
    data = c(3.5, 2.6, 9.4, 2.7))

edges_1 <-
  create_edge_df(
    from = c(1, 2, 3, 4),
    to = c(2, 3, 4, 1),
    rel = "requires",
    color = "green",
    data = c(2.7, 8.9, 2.6, 0.6))

graph <- create_graph(nodes_df = nodes_1, edges_df = edges_1)
```


## references:

* [DiagrammeR-github](https://github.com/rich-iannone/DiagrammeR)
* [DiagrammeR-docs](http://rich-iannone.github.io/DiagrammeR/docs.html)
* [mermaid-docs](https://mermaidjs.github.io/)
* [graphviz-docs](https://www.graphviz.org/documentation/)
* [S-DOT](http://www.martin-loetzsch.de/S-DOT/index.htmls)
* [dotguide](http://graphviz.org/pdf/dotguide.pdf)
* [Graphviz入门](https://www.cnblogs.com/born2run/p/9581386.html)
* [draw.io](https://www.draw.io)
