# R

## Environments

1. Deployment
    1. R For Linux

        ```bash
        yum install epel-release
        yum install R
        # if [ ! /usr/lib64/libpq.so.5 ]
        ln -s /usr/local/pgsql/lib/libpq.so.5 /usr/lib64
        ```
    2. RStudio-Server
   
        ```bash
        wget https://download2.rstudio.org/rstudio-server-rhel-1.1.463-x86_64.rpm
        yum install rstudio-server-rhel-1.1.463-x86_64.rpm
        # verify
        rstudio-server verify-installation
        # firewall
        firewall-cmd --permanent --add-port=8787/tcp
        systemctl reload firewalld
        ```
    3. ShinyServer
    
        ```bash
        wget https://download3.rstudio.org/centos5.9/x86_64/shiny-server-1.5.5.872-rh5-x86_64.rpm
        yum install --nogpgcheck shiny-server-1.5.5.872-rh5-x86_64.rpm
        ```
    4. Shinyproxy
        1. install
    
            ```sh
            SHINYPROXY_VERSION = 2.1.0
            wget https://www.shinyproxy.io/downloads/shinyproxy-${SHINYPROXY_VERSION}.jar
            ```
        2. operations
            1. start: `java -jar shinyproxy-${SHINYPROXY_VERSION}.jar`
            2. docker image
        
                ```
                FROM conoria/alpine-r-bookdown
                RUN R -q -e 'bookdown::render_book("index.Rmd", "bookdown::gitbook")' && mv _book /public
                ```
        3. configuration
            1. update jar file in `BOOT-INF` folder: `jar -uf0 shinyproxy-${SHINYPROXY_VERSION}.jar BOOT-INF`
            2. localization
        
                ```
                # shinyproxy/BOOT-INF/lib/containerproxy...jar::templates/login.html
                "Please sign in:" -> "请登录: " or give it a blank value
                placeholder="User name" -> "用户名"
                placeholder="Password" -> "密码"
                "Sign in" -> "登录"
                "<strong>Could not sign in!</strong><br><span th:text="${error}"></span>"
                "<strong>无法登陆!</strong><br><span th:text="用户名或密码无效"></span>"
            
                # shinyproxy/BOOT-INF/classes/fragments/navbar.html
                "Admin" -> "管理员"
                "Sign Out" -> "退出"
            
                # shinyproxy/BOOT-INF/classes/templates/app.html
                Launching -> "正在加载"
                ```
2. Configuration
    1. `?Startup` describes initialization at start of an R session
    2. `~/.Renviron	`
    
        ```bash
        # Install package path
        R_LIBS_USER="~/R"
    
        # Environment
        JAVA_HOME=...
        HADOOP_HOME=...
        HADOOP_CONF_HOME=...
        SPARK_HOME=...
        SPARK_CONF_HOME=...
        ...
        ```
    3. `~/.Rprofile`
    
        ```r
        # CRAN mirror
        # CRANextra mirror supports some packages compiled for windows
        # local({code ...}) if code needs to be executed
        # options(...)
        local({
            r <- getOption("repos")
            r["CRAN"] <- "https://mirrors.tuna.tsinghua.edu.cn/CRAN/"
            r["CRANextra"] <- "http://www.stats.ox.ac.uk/pub/RWin"
            options(repos = r)
        })
    
        # shiny
        local({ 
            options(
                shiny.port = 3838, 
                shiny.host = "0.0.0.0",
                DT.options = list(
                    scrollX = TRUE, 
                    language = list(url = "//cdn.datatables.net/plug-ins/1.10.11/i18n/Chinese.json")
                    )
            )
        })
    
        # .First: executes when R starts
        .First <- function() {
        library(ggplot2)
        ...
        }
    
        # .Last: executes when R quits
        .Last <- function() {
        cat("goodbye")
        ...
        }
        ```
3. Execution
    1. write a script, e.g., `foo.R`

        ```r
        #!/usr/bin/env Rscript
        print("hello, world!")
        ```
    2. execution
        1. expressions
            1. `Rscript -e "print('hello, world!')"`
            2. `Rscript -e "bookdown::render_book('index.Rmd', 'bookdown::gitbook')"`
        2. script
            1. `./foo.R`
            2. `Rscript foo.R`  

## Basic

1. Data Types
    1. Constants
        1. value
            1. `NULL`: absent object
            2. `NA`: Not Available, absent value, missing value
            3. `NaN`: Not a Number, without meaning
                1. `log(-2)`
                2. `0 / 0`
            4. `Inf`, `-Inf`: positive and negative infinity
                1. `1 / 0 ` => `Inf`
                2. `-1 / 0` => `-Inf`
                3. `log(0)` => `-Inf`
        2. test
            1. `is.null()`
            2. `is.na()`: `TRUE` for `NA` and `NaN`
            3. `is.nan()`
            4. `is.infinite()`: `FALSE` for `NA` and `NaN`
            5. `is.finite()`: `FALSE` for `NA` and `NaN`

            so `is.finite(x) != is.infinite(x)` is `FALSE` when `x = NA` or `NaN`.

    2. Vectors: base types in R
        1. attributes
            1. Names: name the elements of a vector
            2. Dimensions: make a vector behave like a matrix or array
            3. Class: implement S3 object oriented system which controls how generic functions work
        2. types
            1. atomic vector
                1. properties
                    1. consists of length and identical basic data type. R has six basic types, and `.Machine` lists numeric value ranges:
                    2. integer and double are collectively called numeric, so `is.numeric()` is `TRUE` for both of them.
                    3. implicit conversion order is: logical > integer > double > character.

                        : (\#tab:r-conversion) R Basic Types Implicit Conversion

                        | Types     | logical | integer | double | character |
                        | --------- | ------- | ------- | ------ | --------- |
                        | logical   | TRUE    | 1L      | 1      | TRUE      |
                        | integer   | -       | 1L      | 1      | "1"       |
                        | double    | -       | -       | 1      | "1"       |
                        | character | -       | -       | -      | "1"       |
                2. types
                    1. logical: `[TRUE, FALSE, NA]`
                    2. character: `["abc", ..., NA_character_, NA]`
                    3. integer: `[1L, ..., NA_integer_, NA]`
                    4. double: `[1, 1.0, ..., NaN, Inf, -Inf, NA_real, NA]`
                    5. complex: `[1+1i, ..., NA_complex_, NA]`
                    6. raw

            2. Recursive Vector
                1. List: generic vector, elements can have different types, `x <- list(a=10, b=TRUE, c= "hello")`
                    1. `x["a"]`: return a sublist containing `a`
                    2. `x[["a"]]`: return the `a` value
                    3. `x$a`: same as `x[["a"]]`
            3. Augmented Vector: Vectors with additional attributes, including class
                1. factor: builts on integer vectors
                2. date: builds on numeric vectors, represents days since `1970-01-01`
                3. date-time: builds on numeric vectors with class POSIXct, represents seconds since `1970-01-01 00:00:00`
                1. data.frame: builds on lists with attributes names, row.names and class
2. Functions
    1. types
        1. builtin
        2. closure
        3. special
    1. packages
        1. `sudo su - -c "R -e \"install.packages('ggplot2', repos='...')\""`
        2. `install.packages(c("pkg1", "pkg2))`
        3. `update.packages("pkg1")`
        4. `remove.packages("pkg1")`
        5. `if (!requireNamespace("remotes")) install.packages("remotes")`
        6. `library("pkg1")`: load and attach package on the search list
        7. `search(), searchpaths()`: gives a list of attached packages`
        8. `.Library`:  default library location
        9. `.libPaths()`: all library trees R knows
        10. `help(package="pkg")`
    2. common
        1. `is()`: list all classes that an object inherits from
        2. `class()`
        3. `inherits()`
        4. `is.object()`: `FALSE` when an object is a pure base type, not S3, S4 or RC
        5. `object.size()`
        6. `str()`
        7. `typeof()`
        8. `length()`
        9.  `nrow()`
        10. `names()`
        11. `setNames()`
        12. `attributes()`
        13. `attr()`
        14. `dim()`
        15. `sample()`
        16. `seq()`
        17. `seq_along()`
        18. `seq_len()`
        19. `rep()`
        20. `sort()`
        21. `order()`
        22. `unlist()`
        23. `which()`
            1. `which.max()`
            2. `which.min()`
        24. `any()`
        25. `all()`
    3. string
        1. `nchar()`
        2. `nzchar()`
        3. `strrep()`
        4. `strwrap()`
        5. `strsplit()`
        6. `grep()`
        7. `gsub()`
    4. set
        1. `match()`
        2. `%in%`
        3. `unique()`
        4. `intersect()`
        5. `union()`
        6. `setdiff()`
    5. apply
        1. `lapply()`
        2. `sapply()`
        3. `vapply()`
    6. system
        1. `require()`
        2. `library()`
        3. `getwd()`
        4. `setwd()`
        5. `R.home()`
        6. `SessionInfo()`
        7. `options()`
        8. `getOption()`
        9. `View()`
    7. exception
        1.  `stop()`
        2. `stopifnot()`
        3. `warning()`
    8. file
        1. `basename()`
        2. `dirname()`
        3. `list.files()`
        4. `list.dirs()`
        5. `system.file()`
        6. `file.path("a", "b")`
        7. `path.expand("~")`
        8. `normalizePath(".")`
        9. `tempdir()`
        10. `tempfile()`
3. control flow
    1. if

        ```r
        if (logical) {...
        } else if (logical) {
        ...
        } else {
        }
        ```
    2. `ifelse()`
    3. `switch()`
4. OO
    1. S3
        1. properties
            1. usually built on lists, or atomic vectors with attributes
            2. `is.object() & !isS4(x)` closely tests whether the object is an S3 object. Methods belong to functions, not classes. 
            3. the functions are called *generic function*, and use *method dispatch* to call the object's specific function.
        2. definition

            ```r
            foo <- structure(list(), class = "foo")
            foo <- list(); class(foo) <- "foo"

            inherits(foo, "foo")

            f <- function(x) UseMethod("f")
            f.foo <- function(x) "Class foo"
            f.default <- function(x) "Unknown class"

            f <- function(x, ...) UseMethods("f")
            f.foo <- function(x, y) paste("Class foo", y)
            ```
        3. Generic Related Functions
            1. `UseMethod("as.Date")`
            2. `methods("as.Date"); methods(class = "data.frame")`
            3. `getS3method("as.Date", "default")`
        4. Group Generic Methods: group several related functions together, see `?groupGeneric`, including:
            1. Math
                1. abs
                2. sign
                3. sqrt
                4. floor
                5. cos
                6. sin
                7. log
                8. exp
                9. ...
            2. Ops
                1. `+ - * / ^ %% %/%`
                2. `== != < <= >= >`
                3. `& | !`: vector returns
                4. `&& ||`: scalar returns
            3. Summary
                1. all
                2. any
                3. sum
                4. prod
                5. min
                6. max
                7. range
            4. Complex
                1. Arg
                2. Conj
                3. Im
                4. Mod
                5. Re
                6. S4
                7. RC
    2. S4: 
        1. properties
            1. all S4 related code is stored in the `methods` package. `isS4()` can identify an S4 object.
        2. class and objects
            1. general

                ```r
                setClass("Person",
                    slots = list(name = "character", age = "numeric")
                )

                setClass("Employee",
                    slots = list(boss = "Person"),
                    contains = "Person"
                )

                alice <- new("Person", name = "Alice", age = 40)
                john <- new("Employee", name = "John", age = 20, boss = alice)
                alice@age
                slot(john, "boss")
                ```
            2. if an S4 ojbect contains (inherits from) an S3 class or a base type, it will have a `.Data` slot which contains the underlying base type or S3 object.

                ```r
                setClass("RangeNumeric",
                    contains = "numeric",
                    slots = list(min = "numeric", max = "numeric")
                )

                rn <- new("RangeNumeric", 1:10, min = 1, max = 10)
                rn@.Data
                ```
        3. Generics and Method Dispatch {-}
            1. `setGeneric()` creates a new generic or converts an existing function to a generic.

                ```r
                setGeneric("myGeneric", function(x) {
                    standardGeneric("myGeneric") # equivalent to UseMethod()
                })

                setGeneric("union")
                ```
            2. `setMethod()` takes the name of the generic, the classes the method should be associated with and a function that implements the method.

                ```r
                setMethod("union",
                    c(x = "data.frame", y = "data.frame"),
                    function(x, y) {
                        unique(rbind(x, y))
                    }
                )
                ```
            3. Related Functions
                1. `class?mle`: find the docs for a class
                2. `?S4groupGeneric`
                3. `isGeneric()`
                4. `getGenerics()`: get a list of all S4 generics
                5. `getClasses()`: get a list of all S4 classes
                6. `initialize()`
                7. `showClass()`
                8. `getMethod()`
                9. `showMethods()`: get a list of all S4 methods
                10. `callGeneric()`: call the current generic function from a method
                11. `selectMethod("nobs". list("mle"))`: select which method gets called
                12. `callNextMethod()`: call parent method
                13. `setAs()`
                14. `setValidity()`
5. debugging: see [Debugging R Code](https://rstudio-education.github.io/hopr/debug.html).
    1. `traceback()`
    2. `browser()`
        1. `n`: execute next line
        2. `s`: step into function
        3. `f`: finish current function/loop
        4. `c`: continue execution normally
        5. `Q`: stop debugging
        6. `where`: print current position
        7. `get("n")`: get value from object `n`
    3. `debug(sample)`
    4. `isdebugged(sample)`
    5. `undebug(sample)`
    6. `debugonce`
    7. `trace("sample", browser, at = 4)`
    8. `untrace(sample)`
    9. `recover()`

## Packages

1. rmarkdown
    1. references
        1. [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/)
        2. [bookdown: Authoring Books and Technical Documents with R Markdown](https://bookdown.org/yihui/bookdown/)
        3. [Knitr Options](https://yihui.org/knitr/options/)
        4. [Tinytex](https://yihui.org/tinytex/)
    2. commands
        1. `rmarkdown::pandoc_version()`
    3. hook

        ````r
        ```{r init, include=FALSE}
        library(knitr)
        hook_output = knit_hooks$get('output')
        knit_hooks$set(output = function(x, options) {
          # this hook is used only when the linewidth option is not NULL
          if (!is.null(n <- options$linewidth)) {
            x = knitr:::split_lines(x)
            # any lines wider than n should be wrapped
            if (any(nchar(x) > n)) x = strwrap(x, width = n)
            x = paste(x, collapse = '\n')
          }
          hook_output(x, options)
        })
        ```
        ````
    5. other related
        1. showtext
        2. tinytext
            1. `tinytex::install_tinytex()`
            1. `tinytex::uninstall_tinytex()`
            2. `tinytex::reinstall_tinytex()`
            3. `tinytex::tlmgr_update()`
        3. xaringan
            1. install: `remotes::install_github('yihui/xaringan')`
            2. comile
                1. `rmarkdown::render('foo.Rmd', 'xaringan::moon_reader')`
                2. `names(xaringan:::list_css())`: available themes
                3. `xaringan::summon_remark()`: download a copy of remark.js in advance, stored default in libs/remark-latest.min.js
        4. bookdown
            1. compile
                1. `bookdown::render_book('index.Rmd', 'bookdown::gitbook')`
                2. `bookdown::render_book('index.Rmd', 'bookdown::pdf_book')`
                3. `bookdown::render_book('index.Rmd', 'bookdown::epub_book')`
                4. `bookdown::preview_chapter()`: render only one chapter at a time`
                5. `bookdown::server_book()`
            2. structure
                1. `bookname/`
                    1. `_bookdown.yml`

                        ```yaml
                        book_filename: "book name" # filename of the main Rmd file (e.g., merged from all chapters),  _main.Rmd default
                        language:
                          label:
                            fig: 'Figure '
                            tab: 'Table '
                            eq: 'Equation '
                            thm: 'Theorem '
                            lem: 'Lemma '
                            cor: 'Corollary '
                            prp: 'Proposition '
                            cnj: 'Conjecture '
                            def: 'Definition '
                            exm: 'Example '
                            exr: 'Exercise '
                            proof: 'Proof. '
                            remark: 'Remark. '
                            solution: 'Solution. '
                          ui:
                            chapter_name: ["Chapter", !expr function(i) paste('Chapter', i), # i is the chapter number
                                           !expr function(i) paste0(chapter_name[1], i, chapter_name[2])]
                            edit: Edit
                            appendix_name: "" # similar to chapter_name
                        delete_merged_file: true
                        before_chapter_script: ["script1.R", "script2.R"] # executed before each chapter
                        after_chapter_script: script3.R
                        rmd_subdir: [true, false] # whether to search for book source Rmd files in subdirectories
                        rmd_files: ["index.Rmd", "abs.Rmd", "intro.Rmd"] # define list and order of Rmd files to compile
                        rmd_files:
                          html: [a.Rmd, b.Rmd, c.Rmd] # file for html output
                          latex: [b.Rmd, c.Rmd] # file for pdf output
                        output_dir: "book-output" # _book default
                        clean: ["my-book.bbl", "R-packages.bib"]
                        ```
                    2. `_output.yml`

                        ```yaml
                        bookdown::html_book:
                          theme: [null, default, cerulean, journal, flatly, darkly, readable, spacelab, united, cosmo, 
                                  lumen, paper, sandstone, simplex]
                          includes:
                            in_header: style.css
                        bookdown::gitbook:
                          css: style.css
                          includes:
                            in_header: [style.css, math.html]
                            before_body:
                            after_body:
                          highlight: [default, tango, pygments, kate, monochrome,
                                      espresso, zenburn, haddock, breezedark]
                          lib_dir: "book_assets"
                          split_by: ["chapter", "chapter+number", "section", "section+number", "rmd", "none"]
                          config:
                            toc:
                              collapse: [null, section, subsection]
                              scroll_highlight: yes
                              before: null
                              before: |
                                <li><a href="...">Awesome Book</a><li>
                                <li><a href="...">Wonderful Book</a><li>
                              after: null
                              after:  |
                                <li><a href="...">published with bookdown</a><li>
                              toolbar:
                                position: [fixed, static]
                              search: yes
                              edit: null
                              download: [null<d>, no, ["pdf", "epub", "mobi"]<+>, ["book.pdf", "book.epub"]<+>]
                              download:
                                - ["book.pdf", "PDF"]
                                - ["book.epub", "EPUB"]
                            fontsettings: [null, no]
                            fontsettings:
                              theme: [white, Sepia, Night]
                              family: sans
                              size: 2 # can be 1-4
                            sharing: [null, no]
                            sharing:
                              facebook: yes
                              github: no
                              twitter: yes
                              linkedin: no
                              weibo: no
                              instapaper: no
                              vk: no
                              all: ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
                            info: [no, yes]
                        bookdown::pdf_book:
                          includes:
                            in_header: tex/header.tex
                            before_body:
                            after_body:
                          dev: "cairo_pdf"
                          keep_tex: yes
                          latex_engine: xelatex
                          citation_package: [biblatex, natbib]
                          toc: yes
                          toc_depth: 3
                          template: null
                        bookdown::epub_book: default
                        ```
                    3. `index.Rmd`
                        1. treated as the first file when merging all Rmd files if exists. filenames starting with underscore "_" are always ignored.
                        2. YAML metadata is specified in the first Rmd file of the book, always in `index.Rmd`
                        
                            ```yaml
                            ---
                            title: "book title"
                            author: ""
                            date: "`r Sys.Date()`"
                            site: bookdown::bookdown_site # for RStudio use
                            output: bookdown::gitbook
                            documentclass: book # for LaTeX output
                            bibliography: [one.bib, another.bib, ...]
                            biblio-style: apalike
                            link-citations: yes # adds internal links to the bibliography entry in the HTML output
                            nocite: "@*" # force all bibliography displayed even if they are not cited in body
                            lot: yes # list of tables
                            lof: yes # list of figures
                            fontsize: 12pt
                            monofont: "Source Code Pro"
                            monofontoptions: "Scale=0.7"
                            github-repo: rstudio/bookdown # The GitHub repository
                            description: "more info about the book" # <meta name="description" content="..."> for web SEO
                            url: "https\://bookdown.org/john/awesome/" # book's website
                            favicon: "favicon.ico"
                            cover-image: "path/to/image" # The path to the cover image of the book
                            apple-touch-icon: "touch-icon.png" # for IOS
                            apple-touch-icon-size: 120
                            ---
                            ```
                    5. `01-intro.Rmd`
                    6. `02-method.Rmd`
                    7. `xx-others.Rmd`
        5. knitr
            1. Global Options
                1. `options(knitr.graphics.auto_pdf = TRUE)`
                2. `knitr::opts_knit$get("")`
                3. `knitr::opts_knit$set("")`: package options
                4. `knitr::opts_chunk$get()`: get code chunk options
                5. `knitr::opts_chunk$set()`: set chunk options


                ```r
                    ```{r setup, include = FALSE}
                    knitr::opts_chunk$set(
                        echo = FALSE,
                        warning = FALSE,
                        fig.showtext = TRUE,
                        engine.path = list(
                            python="~/.bin/python",
                            ruby="~/.bin/ruby"
                        )
                    )
                    options(digits = 2)
                    ```
                ```
            2. Commands
                1. `knitr::include_graphics()`
                2. `knitr::kable()`
                3. `knitr::include_url()`: include a web page throught its URL, when output is HTML, iframe is used`
                4. `knitr::is_html_output()`
                5. `knitr::is_latex_output()`
                6. `knitr::knit_engines$get()`
                7. `knitr::write_bib()`
            3. Chunk Options
                1. `echo = [TRUE<d>, FALSE]`: whether to display the source code in the output document
                2. `eval = [TRUE<d>, FALSE]`: whether to evaluate the code chunk
                3. `results = ["markup"<d>, "asis", "hold", "hide"|"FALSE"]`: how to display text results
                4. `include = [TRUE<d>, FALSE]`: when FALSE, source and results hidden, while code still evaluated, plots generated too
                5. `error = [TRUE<d>, FALSE]`
                6. `warning = [TRUE<d>, FALSE]`
                7. `message = [TRUE<d>, FALSE]`
                8. `comment = "#>"`: output comments distinguish from regular comments
                9. `cache = [FALSE<d>, TRUE]`: whether to cache results when the code chunks are time-consuming
                10. `child = c("file1.Rmd", "file2.Rmd", ...)`
                11. `fig.showtext<?> = TRUE`: for Chinese character display in the plot
                12. `fig.path = "figures/"`
                13. `fig.cap = [NULL<d>, " A figure caption"]`
                14. `fig.width = 6`: size in inches
                15. `fig.height = 4.2`
                16. `fig.asp = 0.7`: the ratio of figure height/width
                17. `fig.align = ["default"<d>, "left", "right", "center"]`: default not make any alignment adjustments
                18. `fig.link = "https://..."`: a link added to the plot
                19. `out.width = [7, "30%", c("50%", "50")]`
                20. `out.height = 7`: specifies the output size
                21. `fig.show = ["hold"]`: when "hold", plots put together, side by side if total out.width not succeed the width
                22. `engine = ["R"<d>, "python", "sql", "bash", ...]`
                23. `engine.path=[null<d>, list(python="~/.bin/python", ruby="~/.bin/ruby")]`
2. database related
    1. RSQLite: Sqlite
    2. RMariaDB: MySQL or MariaDB
    3. RPostgres: PostgreSQL
3. odbc
    1. references
        1. [rstudio-db](https://db.rstudio.com/)
    2. configurations
        1. Linux
            1. `yum install unixODBC unixODBC-devel`: dependent on the driver manager unixODBC
            2. `odbcinst -j` lists configuration files.
            3. `/etc/odbcinst.ini; ~/odbcinst.ini`
            
                ```ini
                [SQLite3]
                Description = SQLite ODBC Driver
                Driver = /usr/local/devart/odbcsqlite/libdevartodbcsqlite.3.0.1.x64.so
                Setup = /usr/local/devart/odbcsqlite/libdevartodbcsqlite.3.0.1.x64.so
            
                [Mariadb]
                Description = Mariadb driver
                Driver = /usr/lib64/libmaodbc.so
            
                [PostgreSQL]
                Description = Postgresql driver for GNU/Linux
                Driver = /usr/lib64/psqlodbcw.so
                Setup = /usr/lib64/libodbcpsqlS.so
            
                [Hive]
                Description = cloudera hive driver
                Driver = /opt/cloudera/hiveodbc/lib/64/libclouderahiveodbc64.so
                ```
            4. `/etc/odbc.ini; ~/.odbc.ini`: datasources for system and users (DNS)

                ```ini
                [sqlite3]
                Description = My SQLite test database
                Driver = SQLite3
                Database = /path/to/file.db

                [mariadb]
                Driver = Mariadb
                Server = localhost
                Port = 3306
                Database = db
                Socket = /path/to/mysql.sock
                User = user
                Password = pwd

                [postgresql]
                Driver = PostgreSQL
                Servername = localhost
                Port = 5432
                Database = db
                UserName = user
                Password = pwd

                [hive]
                Driver = Hive
                Host = localhost
                Port = 10000
                Database = db
                AuthMech = 3
                Username = user
                Password = pwd
                ```
    3. drivers
        1. SQLite3

            ```bash
            wget https://www.devart.com/odbc/sqlite/devart-odbc-sqlite.x86_64.rpm
            rpm -ivh devart-odbc-sqlite.x86_64.rpm
            ```
        2. MariaDB/MySQL
            1. Linux

                ```bash
                # MySQL
                wget https://dev.mysql.com/get/Downloads/Connector-ODBC/8.0/mysql-connector-odbc-8.0.14-1.el7.x86_64
                rpm rpm -ivh mysql-connector-odbc-8.0.14-1.el7.x86_64.rpm

                # MariaDB (recommended)
                wget https://downloads.mariadb.com/Connectors/odbc/connector-odbc-3.0.8/mariadb-connector-odbc-3.0.    8-ga-rhel7-x86_64.tar.gz
                tar xf mariadb-connector-odbc-3.0.8-ga-rhel7-x86_64.tar.gz
                cp lib64/libmaodbc.so /usr/lib64/
                ```
            2. [Windows](https://dev.mysql.com/downloads/connector/odbc/)

        3. PostgreSQL
            1. Linux: `yum install postgresql-odbc`
            2. [Windows](https://www.postgresql.org/ftp/odbc/versions/msi/):
                1. when defines DNS, using driver `PostgreSQL Unicode (x64)`
                2. set `Option -> Datasource -> Page2 -> Connect Strings: set client_encoding to 'UTF8'` when chinese characters do not display normally
        4. Hive
            1. [Linux ClouderaHiveODBC](https://www.cloudera.com/downloads/connectors/hive/odbc/2-6-1.html)

                ```bash
                wget https://downloads.cloudera.com/connectors/hive_odbc_2.6.1.1001/Linux/ClouderaHiveODBC-2.6.1.1001-1.x86_64.rpm
                rpm -ivh ClouderaHiveODBC-2.6.1.1001-1.x86_64.rpm
                ```
            2. [Microsoft Hive ODBC](https://www.microsoft.com/en-us/download/details.aspx?id=40886)

                When defines DNS, setting "Advanced Options" -> "Unicode SQL character type" if chinese characters do not display normally.
        5. [Impala](https://www.cloudera.com/downloads/connectors/impala/odbc/2-6-5.html)
            1. Windows: `DSN -> Advanced Options -> Use SQL Unicode Types`
    4. connections: when connecting to databases, choose odbc or R database packages.
        1. odbc
            1. connect: `con <- DBI::dbConnect(odbc::odbc(), dsn = "dsn")`
            2. disconnect: `DBI::dbDisconnect(con)`
        2. database package
            1. drivers
                1. sqlite: `RSQLite::SQLite()`
                2. MySQL or MariaDB: `RMariaDB::MariaDB()`
                3. PostgreSQL: `RPostgres::Postgres()`
                    1. for Windows, when using driver `RPostgreSQL::PostgreSQL()`, not `RPostgres::Postgres()`, it may need change client encoding before executing queries `RPostgreSQL::postgresqlpqExec(con, "SET client_encoding = 'GBK'")`
            2. connect: `con <- DBI::dbConnect(driver, user, password, host, port, dbname, ...)`
            3. disconnect: `DBI::dbDisconnect(con)`
            4. example
                1. `con <- DBI::dbConnect(RSQLite::SQLite(), ":memory:")`
                2. `con <- DBI::dbConnect(RPostgres::Postgres(), user="user", password="pwd", ...)`
    5. operations
        1. table
            1. `DBI::Id(cluster="mycluster", catalog = "mycatalog", schema="schema_name", table="table_name")`: refer to table nested in a hierarchy, postgresql, sqlserver, e.g..
            2. `DBI::dbExistsTable()`
                1. `DBI::dbExistsTable(con, "tos_os_p")`
                2. `DBI::dbExistsTable(con, DBI::id(schema="dw", table="tos_os_p"))`
            3. `DBI::dbCreateTable()`
            4. `DBI::dbAppendTable()`
            5. `DBI::dbReadTable()`
            6. `DBI::dbWriteTable()`
                1. `DBI::dbWriteTable(con, Id(schema="dw", "table="tos_os_p"), batch_rows = 10000, overwrite = TRUE)`
            7. `DBI::dbRemoveTable()`
            8. `DBI::dbListFields()`
        2. queries
            1. `DBI::dbGetQuery()`: send query, retrieve results and clear result set, best for interactive use
            2. `DBI::dbSendQuery() DBI::dbFetch()`  `DBI::dbHasCompleted DBI::dbClearResult()`
            3. `DBI::dbExecute()`: execute an update query best for interactive
            4. `DBI::dbSendStatement()`: execute data manipulation (update, insert into, delete, drop table,...)
            5. `DBI::dbListTables()`: not supports schema, use DBI::dbGetQuery() when needed
            6. `DBI::dbBegin() DBI::dbCommit() DBI::dbRollback()`: for transactions
4. pool
    1. `pool <- dbPool(odbc::odbc(), dsn = "dsn")`
    2. `poolClose(pool)`
5. dplyr
    1. `vignette("programming")`
    2. `tbl(con, "tos_os_p")`
    3. `tbl(con, in_schema("dw", "tos_os_p")`: use `in_schema` when need, e.g., postgresql
6. openxlsx: excel operations
7. glue: string operations
8. development tools
    1. roxygen2
        1. `vignette("roxygen2")`
        2. `vignette("namespace")`
        3. `vignette("rd")`
    2. usethis
        1. commands
            1. `usethis::create_package()`
            2. `usethis::create_project()`: non-package, e.g., analysis project
            3. `usethis::use_package("package", type=["Imports"<d>,"Suggests", Depends"])`
            4. `usethis::use_data(x, y, ...)`: creates .rda data in package folder `data/`
            5. `usethis::use_data_raw()`: creates R file for generating rda data in package folder `data-raw/`
            6. `usethat::use_vignette()`
            7. `usethat::use_testthat()`: sets up overall testing infrastructure
            8. `usethat::use_test("name")`: creates test-name.R file
            9. `usethis::edit_r_profile()`
            10. `usethis::edit_r_environ()`
            11. `usethis::edit_git_ignore()`
            12. `usethis::use_package_doc()`
        2. `.Rprofile`

            ```r
            options(
              usethis.full_name = "Jane Doe",
              usethis.description = list(
                 `Authors@R` = 'person("Jane", "Doe", email = "jane@example.com", role = c("aut", "cre"), comment = c(ORCID = "YOUR-ORCID-ID"))',
                License = "MIT + file LICENSE",
                Version = "0.0.0.9000"
              ),
              usethis.protocol = "ssh"
            )
            ```
    3. devtools
        1. `devtools::session_info()`
        2. `devtools::document()`
        3. `devtools::build()`
        4. `devtools::load_all()`
        5. `devtools::test()`
        6. `devtools::install("local_package")`
        7. `devtools::install_github('user/repo')`
        8. `devtools::uninstall('package')`
    4. testthat: r unit test
9. ML
    1. mlr3
    2. mlr3learners
    3. mlr3viz
    4. precrec

## R Markdown Usage

1. Configurations
    1. rmarkdown

        ```yaml
        ---
        title: "An R Markdown Document"
        author: "San Li"
        output: ["html_document", "pdf_document]
        output:
          html_document:
            toc: yes
        ---
        ```
    2. xaringan
    
        ```yaml
        ---
        title: "xaringan: from scratch"
        subtitle: ""
        author: "Y"
        institute: "ins center"
        date: "2018-12-28 (updated `r Sys.Date()`)"
        output:
          xaringan::moon_reader:
            seal: false # disable xaringan's title slide, create self title slide
            chakra: libs/remark-latest.min.js # use local remark.js
            css: [default, xaringan.css]
            lib_dir: libs
            nature:
              beforeInit: "macros.js" # self defined js code
              titleSlideClass: [top, left, inverse]
              highlightStyle: github
              highlightLines: true
              countIncrementalSlides: false
              countdown: 60000 # spend time on every slide, e.g., 60 seconds
              autoplay: 30000 # autoplay slides
              autoplay:
                interval: 30000
                loop: true
        ---
        ```
