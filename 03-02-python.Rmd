# Python

## Environment Management

### venv {-}

`venv` module can be used to create virtual environment.

1. create virtual enviromeng

    ```sh
    python3 -m venv virtual-name
    ```

2. activate virtual environment

    ```sh
    source virtual-name/bin/activate; .virtual-name\scripts\activate
    ```

3. quit the environment

    ```sh
    deactivate
    ```

### pip {-}

`pip` is used to manage packages.

Configuration:

* `~/.pip/pip.conf`: for Linux and OSX
* `~\pip\pip.ini`: for Windows

```ini
[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
[install]
trusted-host = https://pypi.tuna.tsinghua.edu.cn
```

Commands:

1. `pip install package`
2. `pip uninstall package`
3. `pip install --upgrade package`
4. `pip list package`
5. `pip show package`
6. `pip search package`
7. `pip freeze > requirements.txt`
8. `pip install -r requirements.txt`

### Conda {-}

Virtual environment:

1. `conda --version`
2. `conda update conda`
3. `conda create --name vtl-name python=3.5`
4. `conda activate vtl-name`
5. `conda activate, conda deactivate`: switch back to default environment (base)
6. `conda info --envs`: list all environments
7. `conda remove --name vtl-name --all`: remove environment
8. `conda config --append channels conda-forge` - adds new channel when "packages not available ..."

Package management:

1. `conda install pkg(=1.1.1)`
2. `conda remove pkg`
3. `conda update pkg`
4. `conda list pkg`
5. `conda search pkg`

## Jupyter Deploy

### Package Dependent {-}

1. ipython
2. line_profiler
3. numpy
4. matplotlib
5. pandas
6. jupyter
7. scipy
8. scikit-learn
9. seaborn
10. tensorflow
11. keras

### Environment Variable {-}

```sh
export IPYTHONDIR=~/.ipython - default value
export MPLCONFIGDIR=~/.config/matplotlib - default value
export JUPYTER_CONFIG_DIR=~/.jupyter - default value
```

### ipython {-}

Commands:

1. `ipython profile create <name>`: create configuration file under `$IPYTHONDIR `
2. `ipython profile locate`
3. `ipython profile list`

Configuration: 

```python
# ${IPYTHONDIR}/profile_default/ipython_config.py
c.InteractiveShellApp.extensions = ["line_profiler"]
c.InteractiveShellApp.exec_lines = [
import numpy as np
import pandas as pd
]
```

### matplotlib {-}

Font install

```sh
mkdir -p /usr/share/fonts/STSong 
mv STSONG.ttf /usr/share/fonts/STSong
mkfontscale 
mkfontdir 
fc-cache -fv

cp STSONG.ttf site-packages/matplotlib/mpl-data/fonts/ttf
rm -rf ${MPLCONFIGDIR}/{fontList.json,tex.cache}
rm -rf ~/.cache/matplotlib - if exists
```

Configuration

```
# ${MPLCONFIGDIR}/matplotlibrc
font.family: STSong
axes.unicode_minus: False
```

### jupyter {-}

Commands:

1. `juypter notebook --generate-config`: generate config file in directory `${JUPYTER_CONFIG_DIR}`
2. `jupyter notebook --no-browser --port=5000 --ip=0.0.0.0`: default port 8888
3. `jupyter notebook password`:  set jupyter login password, or use the following method
4. `python -c "from notebook.auth import passwd; print(passwd('jupyter'))"`

Configuration

```python
# ${JUPYTER_CONFIG_DIR}/jupyter_notebook_config.py
import os                                                                                 
import sys                                                                                
                                                                                          
#  for Mac, set browser value definitely; otherwise jupyter will not open browser automatically                                 
if sys.platform == "darwin":                                                              
    c.NotebookApp.browser = "Safari"
                                                    
c.NotebookApp.notebook_dir = "/server/proj/py-lrn"
#c.NotebookApp.password = "sha1:9e799b2236aa:01085662782c7813128637089192f836901b196d"
```

ipython-notebook.service

```ini
# /usr/lib/systemd/system/ipython-notebook.service
[Unit]
Description=Jupyter Notebook Server

[Service]
Type=simple
Environment="LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib"
Environment="PATH=/usr/local/bin:/usr/bin:$PATH"
ExecStart=/server/proj/.env/py-lrn/bin/jupyter notebook --ip=0.0.0.0 --no-browser                                                   
User=yang
Group=yang

[Install]
WantedBy=multi-user.target
```

## Database {#py-db}

1. MySQL
    * `mysqlclient`
2. PostgreSQL
    * `psycopg2-binary`
3. SQLServer
    * `pymssql`
    * dependencies
        * `freetds-devel`: for `sqlfont.h`
        * `unixODBC-devel`: for sql.h
        * `C_INCLUDE_PATH`: search `sql.h` and other header files

        ```sh
        yum install freetds-devel unixODBC-devel
        export C_INCLUDE_PATH=/usr/include
        ```
4. Hive
    * `pyhive[hive]`
    * dependencies
        * `thrift-sasl`: when meets "TSaslClientTransport' object has no attribute 'readAll'"

        ```sh
        yum install cyrus-sasl-devel cyrus-sasl-plain thrift-sasl
        ```
5. SQLAlchemy
    * connection string: `prefix://username:password@host:port/databasename?parameter=value`
    * prefix:
        * PostgreSQL: `postgresql+psycopg2`
        * MySQL: `mysql`
        * SQLServer: `mssql+pymssql`
    * parameter:
        * MySQL: `charset=utf8`

## Base {#py-base}

Functions

1. `id()`
2.  `sys.getsizeof() - return the size of objects in bytes`
3. `type()`
4. `repr()`
5. `str()`
6. `dir()`
7. `issubclass()`
8. `isinstance()`: `isinstance(True, int) => True`
9. `getattr()`
10. `hasattr()`
11. `class.__mro__`
12. `class.mro()`
13. `class.__bases__`
14. `os.path.abspath(__file__)`
15. `os.path.dirname()`
16. `os.path.join()`
17. `".".join()`

False value

1. `0; 0.0; 0j`
2. `""`
3. `False`
4. `[]`
5. `()`
6. `{}`
7. `None`

Packages

1. `http.server`: `python -m http.server 8888`
